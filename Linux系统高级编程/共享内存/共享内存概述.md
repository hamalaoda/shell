共享内存（Shared Memory）是操作系统提供的**效率最高的进程间通信（IPC）机制**，核心是让多个进程直接访问同一块内核管理的物理内存，无需数据拷贝，大幅减少通信开销。

### 一、核心原理：“一块内存，多进程共享”

1. **内核创建共享内存**:
   - 进程通过系统调用向内核申请一块物理内存，内核为其分配唯一标识（共享内存ID），并记录内存大小、权限等消息。
2. **进程映射到地址空间**：
   - 每个需要访问该内存的进程，通过“内存映射”将这块物理内存关联到自己的虚拟地址空间中。
3. **直接读写内存**：
   - 映射完成后，进程对这块虚拟地址的读写操作，会直接作用于共享的物理内存，其他进程可以实时看到修改（无需内核中转数据）。

![image-20251105151740394](共享内存.assets/image-20251105151740394-1762327066545-1.png)

### 二、关键系统调用（Linux 环境）

共享内存的操作主要依赖 4 个系统调用，流程为 “创建 / 获取 → 映射 → 操作 → 解除映射 → 删除”。

| 系统调用                                                  | 功能描述                                                     |
| --------------------------------------------------------- | ------------------------------------------------------------ |
| `shmget(key_t key, size_t size, int shmflg)`              | 创建或获取共享内存，返回**共享内存 ID**（核心标识）。        |
| `void *shmat(int shmid, const void *shmaddr, int shmflg)` | 将共享内存映射到当前进程的虚拟地址空间，返回映射后的**虚拟地址指针**。 |
| `int shmdt(const void *shmaddr)`                          | 解除当前进程与共享内存的映射（仅断开关联，不删除内存）。     |
| `int shmctl(int shmid, int cmd, struct shmid_ds *buf)`    | 控制共享内存（如 `IPC_RMID` 指令用于删除共享内存）。         |